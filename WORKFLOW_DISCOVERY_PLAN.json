{
  "workflows_found": [
    {
      "filename": "add-feature.md",
      "prompt_name": "add_feature",
      "description": "Autonomous feature development with complete lifecycle from requirements analysis to deployment and documentation"
    },
    {
      "filename": "build-ml-pipeline.md",
      "prompt_name": "build_ml_pipeline",
      "description": "Complete machine learning pipeline creation from data preparation to model deployment and monitoring"
    },
    {
      "filename": "create-agent.md",
      "prompt_name": "create_agent",
      "description": "Autonomous agent creation with role definition, capability specification, and orchestration integration"
    },
    {
      "filename": "create-plugin.md",
      "prompt_name": "create_plugin",
      "description": "Complete plugin development lifecycle including structure generation, agent bundling, and marketplace integration"
    },
    {
      "filename": "create-skill.md",
      "prompt_name": "create_skill",
      "description": "Skill creation workflow for reusable expertise patterns with documentation and integration"
    },
    {
      "filename": "create-workflow.md",
      "prompt_name": "create_workflow",
      "description": "Autonomous workflow creation with phase design, quality gates, and multi-agent orchestration"
    },
    {
      "filename": "deploy.md",
      "prompt_name": "deploy",
      "description": "Safe production deployment with pre-deployment validation, deployment strategies, and automatic rollback capabilities"
    },
    {
      "filename": "fix-bug.md",
      "prompt_name": "fix_bug",
      "description": "Bug fix lifecycle from reproduction and root cause analysis to fix implementation and regression testing"
    },
    {
      "filename": "modernize-legacy.md",
      "prompt_name": "modernize_legacy",
      "description": "Legacy system modernization with architecture analysis, incremental refactoring, and technology upgrades"
    },
    {
      "filename": "new-project.md",
      "prompt_name": "new_project",
      "description": "Complete project creation from requirements analysis to deployment with multi-phase orchestration and quality gates"
    },
    {
      "filename": "optimize-costs.md",
      "prompt_name": "optimize_costs",
      "description": "Infrastructure cost optimization through resource analysis, consolidation, and pricing strategy optimization"
    },
    {
      "filename": "optimize-performance.md",
      "prompt_name": "optimize_performance",
      "description": "Performance optimization targeting bottleneck identification, implementation, and benchmarking validation"
    },
    {
      "filename": "refactor.md",
      "prompt_name": "refactor",
      "description": "Code refactoring with incremental improvements, test validation, and zero behavioral change guarantee"
    },
    {
      "filename": "review-architecture.md",
      "prompt_name": "review_architecture",
      "description": "Comprehensive architecture review with design validation, scalability assessment, and optimization recommendations"
    },
    {
      "filename": "review-code.md",
      "prompt_name": "review_code",
      "description": "Multi-stage code analysis with quality gates covering design, implementation, testing, security, and performance"
    },
    {
      "filename": "review-pr.md",
      "prompt_name": "review_pr",
      "description": "Pull request review with code analysis, test validation, security audit, and automated feedback delivery"
    },
    {
      "filename": "security-audit.md",
      "prompt_name": "security_audit",
      "description": "Comprehensive security auditing from reconnaissance to remediation with compliance validation"
    },
    {
      "filename": "setup-cicd.md",
      "prompt_name": "setup_cicd",
      "description": "CI/CD pipeline setup with automated testing, security scanning, and deployment orchestration"
    },
    {
      "filename": "setup-monitoring.md",
      "prompt_name": "setup_monitoring",
      "description": "Monitoring infrastructure setup with metrics collection, alerting, and observability integration"
    },
    {
      "filename": "test-web-ui.md",
      "prompt_name": "test_web_ui",
      "description": "End-to-end web UI testing with visual testing, functional testing, accessibility validation, and performance analysis"
    }
  ],
  "sample_frontmatter": {
    "current_state": "Workflow files currently DO NOT have YAML frontmatter",
    "specification_from_claude_md": {
      "format": "YAML frontmatter between --- delimiters",
      "required_fields": [
        "description",
        "argument_hint"
      ],
      "argument_hint_note": "Optional but recommended",
      "example": "---\ndescription: Brief description of what this workflow does\nargument-hint: \"[argument-description]\"\n---"
    },
    "location": "/Users/seth/Projects/orchestr8/CLAUDE.md lines 93-99"
  },
  "scanning_algorithm": {
    "pseudocode": [
      "1. INITIALIZE:",
      "   - commands_dir = resolve_path(\"{root}/commands\")",
      "   - workflows = Vec::new()",
      "   - cache = LRU::new(1000_entries)",
      "",
      "2. DISCOVERY PHASE:",
      "   - Use glob::glob(\"**/*.md\") to find all markdown files",
      "   - For each file discovered:",
      "     a. Record file path and size",
      "     b. Extract frontmatter (between --- delimiters)",
      "     c. Parse YAML: description, argument-hint",
      "     d. Extract filename (e.g., 'add-feature.md')",
      "     e. Cache metadata for future lookups",
      "",
      "3. METADATA EXTRACTION:",
      "   - frontmatter = extract_between_delimiters('---', '---')",
      "   - metadata = parse_yaml(frontmatter)",
      "   - On parse error: log warning, use defaults",
      "",
      "4. NAMING CONVENTION CONVERSION:",
      "   - filename 'add-feature.md' -> prompt name 'add_feature'",
      "   - algorithm: kebab_to_snake(stem(filename))",
      "   - impl: replace('-', '_').to_lowercase()",
      "",
      "5. CACHING STRATEGY:",
      "   - TTL-based invalidation (5min default)",
      "   - LRU eviction (1000 entries max)",
      "   - File mtime tracking for invalidation",
      "   - Cold load: <10ms, cached: <1ms",
      "",
      "6. RETURN RESULTS:",
      "   - [{ name, prompt_name, description, argument_hint, file_path, discovered_at }]"
    ],
    "complexity": "O(n) where n = number of .md files in commands/",
    "performance_target": "Metadata only: <100ms for all 20 workflows (< 5ms per file)"
  },
  "naming_convention": {
    "rule": "Kebab-case filename to snake_case prompt name",
    "algorithm": {
      "step_1": "Extract filename stem (remove .md extension)",
      "step_2": "Replace all hyphens (-) with underscores (_)",
      "step_3": "Convert to lowercase (redundant as filenames already lowercase)",
      "step_4": "Result is used with / prefix: /add_feature, /fix_bug, etc."
    },
    "examples": [
      "add-feature.md -> add_feature",
      "create-workflow.md -> create_workflow",
      "review-pr.md -> review_pr",
      "setup-cicd.md -> setup_cicd",
      "test-web-ui.md -> test_web_ui",
      "optimize-performance.md -> optimize_performance"
    ],
    "special_cases": {
      "abbreviations": "Keep as-is (PR, UI, ML, CI/CD become pr, ui, ml, cicd)",
      "numbers": "If present, preserve (example: workflow2.md -> workflow2)",
      "unicode": "If present (rare), handle with unicode normalization"
    }
  },
  "error_cases": {
    "file_system_errors": {
      "description": "Cannot access commands directory",
      "handling": "Return empty list with error log, emit event: workflow_discovery_failed",
      "recovery": "Retry on next invocation after TTL expires"
    },
    "missing_directory": {
      "description": "commands/ directory does not exist",
      "handling": "Log info (not error), return empty workflow list",
      "recovery": "Continue - some setups may not have workflows yet"
    },
    "parse_frontmatter_error": {
      "description": "YAML between --- delimiters is malformed",
      "handling": "Log warning with filename, skip file, continue scanning",
      "recovery": "Use defaults: description = 'Unknown workflow', argument_hint = None"
    },
    "missing_required_fields": {
      "description": "Frontmatter missing 'description' field",
      "handling": "Log warning, use empty string default, continue processing",
      "recovery": "File still included in results with minimal metadata"
    },
    "file_too_large": {
      "description": "Workflow file exceeds size limit (unlikely for text)",
      "handling": "Log warning, skip file, continue",
      "recovery": "User should fix oversized file"
    },
    "unicode_issues": {
      "description": "Filename or content contains invalid UTF-8",
      "handling": "Log warning, skip file or use lossy conversion",
      "recovery": "User should fix encoding"
    },
    "permission_denied": {
      "description": "Cannot read workflow file due to permissions",
      "handling": "Log warning, skip file, continue",
      "recovery": "User should fix file permissions (chmod +r)"
    },
    "duplicate_names": {
      "description": "Multiple workflow files with same prompt name after conversion",
      "handling": "Log warning, keep first occurrence, skip duplicates",
      "recovery": "User should rename conflicting files"
    }
  },
  "data_structures": {
    "workflow_metadata": {
      "name": "String - workflow name (e.g., 'add-feature')",
      "prompt_name": "String - slash command name (e.g., 'add_feature')",
      "description": "String - brief description from frontmatter",
      "argument_hint": "Option<String> - expected arguments (optional)",
      "file_path": "PathBuf - absolute path to workflow file",
      "discovered_at": "SystemTime - when metadata was loaded",
      "file_size": "u64 - file size in bytes",
      "cache_key": "String - hash for deduplication (filename stem)"
    },
    "discovery_result": {
      "workflows": "Vec<WorkflowMetadata> - all discovered workflows",
      "total_count": "usize - number of workflows found",
      "load_time_ms": "f64 - total discovery time in milliseconds",
      "errors": "Vec<DiscoveryError> - any warnings during scanning",
      "cache_hits": "usize - number of cached lookups used",
      "cache_misses": "usize - number of cache misses (cold loads)"
    },
    "discovery_error": {
      "file_path": "String - which file had the issue",
      "error_type": "String - error classification",
      "message": "String - human-readable error message",
      "severity": "Enum - Info | Warning | Error"
    }
  },
  "implementation_notes": {
    "language": "Rust (MCP server extension)",
    "integration_point": "Add workflow discovery to mcp.rs or create new workflows.rs module",
    "dependencies": "glob (already used for agents), serde_yaml (already used for agents)",
    "performance": "Target <100ms for all 20 workflows cold load, <5ms warm cache",
    "caching": "Use existing QueryCache pattern from agent discovery",
    "tools_used": "MCP discovery_workflows tool to expose workflows like agents",
    "backward_compatibility": "Current workflows work without frontmatter (use defaults)",
    "future_enhancement": "Add workflow metadata to plugin.json for marketplace discovery"
  },
  "validation_checklist": [
    "Scan /commands/ directory recursively",
    "Find all .md files",
    "Extract --- delimited YAML frontmatter",
    "Parse: description (required), argument-hint (optional)",
    "Handle missing frontmatter gracefully (log warning, use empty defaults)",
    "Convert filename 'add-feature.md' to prompt name 'add_feature'",
    "Cache results with TTL and file mtime invalidation",
    "Return structured list with metadata",
    "Total scan time < 100ms",
    "Per-workflow parse time < 5ms",
    "Handle all error cases without crashing",
    "Support Unicode in descriptions and filenames",
    "Detect and warn on duplicate prompt names",
    "Log all warnings with context (file path, line number if applicable)"
  ]
}
